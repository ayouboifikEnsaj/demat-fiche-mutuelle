<!-- src/app/components/prise-en-charge-gestionnaire-table/prise-en-charge-gestionnaire-table.component.html -->
<app-navbar-gestionnaire></app-navbar-gestionnaire>
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>{{ 'LISTE_PRISES_EN_CHARGE' | translate }}</h2>
    <div>
      <button class="btn btn-success me-2" (click)="creerPriseEnChargeAbsent()">
        <i class="bi bi-plus-circle me-2"></i>
        {{ 'CREER_POUR_ABSENT' | translate }}
      </button>
      <button class="btn btn-outline-secondary" (click)="exporterCSV()">
        <i class="bi bi-file-earmark-excel me-2"></i>
        {{ 'EXPORTER_CSV' | translate }}
      </button>
    </div>
  </div>

  <!-- Filtres -->
  <div class="row g-3 mb-4 align-items-end">
    <!-- Date Soumission -->
    <div class="col-md-3">
      <label for="dateSoumission" class="form-label">{{ 'SUBMITION.DATE' | translate }}</label>
      <input type="date" id="dateSoumission" class="form-control"
             [(ngModel)]="dateSoumission"
             (change)="filterPriseEnCharges()">
    </div>

    <!-- Nom employé -->
    <div class="col-md-3">
      <label for="nomEmploye" class="form-label">{{ 'NOM_EMPLOYE' | translate }}</label>
      <div class="position-relative">
        <input type="text" id="nomEmploye" class="form-control pe-5"
               [(ngModel)]="nomEmploye"
               (input)="filterPriseEnCharges()"
               placeholder="{{ 'RECHERCHER_NOM' | translate }}">
        <i class="bi bi-search position-absolute end-0 top-50 translate-middle-y me-3"></i>
      </div>
    </div>

    <!-- Motif -->
    <div class="col-md-3">
      <label for="motif" class="form-label">{{ 'MOTIF' | translate }}</label>
      <div class="position-relative">
        <input type="text" id="motif" class="form-control pe-5"
               [(ngModel)]="motif"
               (input)="filterPriseEnCharges()"
               placeholder="{{ 'RECHERCHER_MOTIF' | translate }}">
        <i class="bi bi-search position-absolute end-0 top-50 translate-middle-y me-3"></i>
      </div>
    </div>

    <!-- Statut -->
    <div class="col-md-3">
      <label for="statut" class="form-label">{{'FICHE.STATUT' | translate}}</label>
      <select id="statut" class="form-select" [(ngModel)]="statut" (change)="filterPriseEnCharges()">
        <option value="">{{'FILTRE.STATUT.TOUS' | translate}}</option>
        <option value="ENATTENTE">{{'FILTRE.STATUT.ENATTENTE' | translate}}</option>
        <option value="VALIDEE">{{'FILTRE.STATUT.VALIDEE' | translate}}</option>
        <option value="REJETEE">{{'FILTRE.STATUT.REJETEE' | translate}}</option>
        <option value="RETOURCOMPLEMENT">{{'FILTRE.STATUT.RETOURCOMPLEMENT' | translate}}</option>
        <option value="ENCOURDETRAIATEMENT">{{'FILTRE.STATUT.ENCOURSTRAITEMENT' | translate}}</option>
        <option value="ACCORDER">{{'FILTRE.STATUT.ACCORDER' | translate}}</option>
      </select>
    </div>
  </div>

  <!-- Tableau -->
  <div class="table-responsive">
    <table class="table table-striped table-bordered">
      <thead class="table-dark">
      <tr>
        <th>{{ 'TABLE.HEADERS.NOM_PRENOM' | translate }}</th>
        <th>{{ 'MOTIF' | translate }}</th>
        <th>{{ 'SUBMITION.DATE' | translate }}</th>
        <th>{{ 'TABLE.HEADERS.STATUT' | translate }}</th>
        <th>{{ 'TABLE.HEADERS.MONTANT' | translate }}</th>
        <th class="text-center">{{ 'TABLE.HEADERS.ACTIONS' | translate }}</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let priseEnCharge of paginatedPriseEnCharges">
        <td>{{ priseEnCharge.employee?.firstName }} {{ priseEnCharge.employee?.lastName }}</td>
        <td>{{ priseEnCharge.motif }}</td>
        <td>{{ priseEnCharge.dateSoumission | date: 'dd/MM/yyyy' }}</td>
        <td>
  <span class="badge"
        [ngClass]="{
          'bg-warning': priseEnCharge.statutPriseEnCharge === 'En_attente',
          'bg-success': priseEnCharge.statutPriseEnCharge === 'validée_par_rh' || priseEnCharge.statutPriseEnCharge === 'accorder',
          'bg-danger': priseEnCharge.statutPriseEnCharge === 'Rejete',
          'bg-info': priseEnCharge.statutPriseEnCharge === 'Retour_complement_d\'informations',
          'bg-primary': priseEnCharge.statutPriseEnCharge === 'en_cour_de_traitement_par_assurance'
        }">
    {{ getStatutKey(priseEnCharge.statutPriseEnCharge) | translate }}
  </span>
        </td>

        <td>{{ priseEnCharge.montant }} MAD</td>
        <td class="text-center">
          <button
            class="btn btn-sm btn-outline-primary"
            [routerLink]="['/prise-en-charge-gestionnaire', priseEnCharge.id]">
            <i class="bi bi-eye me-1"></i> {{ 'VOIR_DETAILS' | translate }}
          </button>
        </td>
      </tr>

      <tr *ngIf="filteredPriseEnCharges.length === 0">
        <td colspan="6" class="text-center">{{'NO_RESULTS' | translate}}</td>
      </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <nav *ngIf="totalPages > 1" class="d-flex justify-content-center mt-3">
    <ul class="pagination">
      <li class="page-item" [class.disabled]="currentPage === 1">
        <button class="page-link" (click)="currentPage = currentPage - 1" [disabled]="currentPage === 1">
          &laquo;
        </button>
      </li>

      <li class="page-item" *ngFor="let page of [].constructor(totalPages); let i = index"
          [class.active]="currentPage === i + 1">
        <button class="page-link" (click)="currentPage = i + 1">{{ i + 1 }}</button>
      </li>

      <li class="page-item" [class.disabled]="currentPage === totalPages">
        <button class="page-link" (click)="currentPage = currentPage + 1" [disabled]="currentPage === totalPages">
          &raquo;
        </button>
      </li>
    </ul>
  </nav>
</div>
